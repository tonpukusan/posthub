<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>マルチSNS投稿ハブ</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: system-ui, sans-serif;
  margin: 0;
  padding: 20px;
  background: #fff;
}
.container {
  max-width: 600px;
  margin: auto;
}
textarea {
  width: 100%;
  height: 150px;
  padding: 10px;
  font-size: 1rem;
}
button {
  padding: 10px 14px;
  margin: 6px 0;
  font-size: 1rem;
  cursor: pointer;
}
#snsButtons {
  margin-top: 20px;
  display: none;
}
.sns-btn {
  width: 100%;
  margin-bottom: 10px;
}
</style>
</head>

<body>
<div class="container">
  <h2>マルチSNS投稿ハブ</h2>

  <textarea id="text"></textarea>

  <button id="showSNS">投稿</button>
  <button id="closeAll" style="background:#ff4d4d;color:white;">すべて閉じる</button>

  <div id="snsButtons">
    <button class="sns-btn" id="btnX">X に投稿</button>
    <button class="sns-btn" id="btnThreads">Threads に投稿</button>
    <button class="sns-btn" id="btnBsky">Bluesky に投稿</button>
    <button class="sns-btn" id="btnFb">Facebook に投稿</button>
  </div>
</div>

<script>
(function(){

  // ハブウインドウは常に1枚
  window.name = "MULTI_SNS_POST_HUB";

  // SNSタブのハンドル
  let winX = null;
  let winThreads = null;
  let winBsky = null;
  let winFb = null;

  // URLパラメータからテキストを取得
  const params = new URLSearchParams(location.search);
  const t = params.get("text") || "";
  const textarea = document.getElementById("text");
  textarea.value = t;

  // 投稿ボタン → SNSボタン表示 + クリップボードコピー
  document.getElementById("showSNS").onclick = async () => {
    try {
      await navigator.clipboard.writeText(textarea.value);
    } catch(e) {
      console.log("Clipboard copy failed:", e);
    }
    document.getElementById("snsButtons").style.display = "block";
  };

  // SNSタブは名前付き → 最大1枚だけ開く
  document.getElementById("btnX").onclick = () => {
    winX = window.open(
      "https://twitter.com/intent/tweet?text=" + encodeURIComponent(textarea.value),
      "SNS_X"
    );
  };

  document.getElementById("btnThreads").onclick = () => {
    winThreads = window.open("https://www.threads.net/intent/post", "SNS_THREADS");
  };

  document.getElementById("btnBsky").onclick = () => {
    winBsky = window.open("https://bsky.app", "SNS_BSKY");
  };

  document.getElementById("btnFb").onclick = () => {
    winFb = window.open("https://www.facebook.com/", "SNS_FB");
  };

  // すべて閉じるボタン
  document.getElementById("closeAll").onclick = () => {
    [winX, winThreads, winBsky, winFb].forEach(w => {
      if (w && !w.closed) w.close();
    });
    window.close();
  };

  // ハブが閉じられたら SNS も全部閉じる
  window.addEventListener("beforeunload", () => {
    [winX, winThreads, winBsky, winFb].forEach(w => {
      if (w && !w.closed) w.close();
    });
  });

})();
</script>

</body>
</html>
